<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classic Pong Game</title>
    <!-- Using a minimalist, retro style for maximum classic feel -->
         <button onclick="window.location.href='index.html'">
back
    </button>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        body {
            font-family: 'VT323', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background-color: #000; /* Pure black background */
            color: #fff; /* White text for contrast */
            padding: 10px;
            box-sizing: border-box;
            user-select: none; /* Prevent selection */
        }

        h1 {
            font-size: 2.5rem;
            color: #fff;
            margin-bottom: 10px;
            text-shadow: 0 0 5px #fff;
        }

        .game-info {
            font-size: 1.2rem;
            text-align: center;
            margin-bottom: 15px;
            color: #999;
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 600px;
            padding: 10px 0;
            font-size: 3rem;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            margin-bottom: 20px;
        }

        #gameCanvas {
            border: 2px solid #fff; /* Classic white border */
            background-color: #000;
            display: block;
            touch-action: none; /* Prevent scrolling on mobile */
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
        }

        /* Message Box Styling */
        #messageBox {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.85);
            z-index: 10;
        }

        .message-content {
            background-color: #111;
            padding: 30px 40px;
            border-radius: 8px;
            border: 2px solid #fff;
            box-shadow: 0 0 15px #fff;
            text-align: center;
        }

        .message-content h2 {
            font-size: 3rem;
            color: #fff;
            margin-bottom: 15px;
            text-shadow: 0 0 8px #fff;
        }

        .message-content p {
            font-size: 1.5rem;
            margin-bottom: 25px;
            line-height: 1.3;
        }

        .start-button {
            background-color: #fff;
            color: #000;
            border: none;
            padding: 10px 25px;
            font-family: 'VT323', monospace;
            font-size: 1.8rem;
            cursor: pointer;
            border-radius: 4px;
            box-shadow: 0 4px 0 #999;
            transition: background-color 0.1s, transform 0.1s;
        }

        .start-button:active {
            box-shadow: 0 1px 0 #999;
            transform: translateY(3px);
        }

        /* Responsive Adjustments */
        @media (max-width: 600px) {
            h1 { font-size: 2rem; }
            .score-display { font-size: 2rem; margin-bottom: 10px;}
            .game-info { font-size: 1rem; }
            .message-content p { font-size: 1.2rem; }
            .message-content h2 { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

    <h1>PONG</h1>
    
    <div class="game-info">
        Player 1 (Left): **W** / **S** | Player 2 (Right): **▲** / **▼**
    </div>

    <div class="score-display">
        <span id="player1Score">0</span>
        <span id="player2Score">0</span>
    </div>

    <canvas id="gameCanvas"></canvas>

    <!-- Game Message Box -->
    <div id="messageBox">
        <div class="message-content">
            <h2 id="messageTitle">CLASSIC PONG</h2>
            <p id="messageText">
                First to 10 points wins!<br>
                Press START to serve the ball.
            </p>
            <button class="start-button" id="startButton">START</button>
        </div>
    </div>

    <script>
        // --- Game Setup Constants ---
        const CANVAS_ID = 'gameCanvas';
        const PADDLE_HEIGHT_RATIO = 0.15; // 15% of canvas height
        const PADDLE_WIDTH_RATIO = 0.015; // 1.5% of canvas width
        const BALL_SIZE_RATIO = 0.015; // 1.5% of canvas width
        const PADDLE_SPEED = 6; // pixels per frame
        const MAX_BALL_VELOCITY = 15; // Max speed for ball
        const INITIAL_BALL_SPEED = 3; // New constant: Slower starting speed for the ball
        const WINNING_SCORE = 10;
        const FONT = 'VT323, monospace';

        // --- DOM Elements ---
        const canvas = document.getElementById(CANVAS_ID);
        const ctx = canvas.getContext('2d');
        const player1ScoreDisplay = document.getElementById('player1Score');
        const player2ScoreDisplay = document.getElementById('player2Score');
        const messageBox = document.getElementById('messageBox');
        const messageTitle = document.getElementById('messageTitle');
        const messageText = document.getElementById('messageText');
        const startButton = document.getElementById('startButton');

        // --- Game State Variables ---
        let gameActive = false;
        let p1Score = 0;
        let p2Score = 0;
        let lastTime;

        // Game objects
        let p1 = {};
        let p2 = {};
        let ball = {};
        let keys = {}; // To track pressed keys

        // --- Initialization and Resizing ---

        function resizeCanvas() {
            // Keep a fixed aspect ratio (e.g., 4:3) and ensure it fits the screen
            const maxWidth = Math.min(window.innerWidth * 0.9, 700);
            const maxHeight = Math.min(window.innerHeight * 0.7, 525);
            
            // Calculate size based on available space while maintaining 4:3 ratio
            let width = maxWidth;
            let height = maxWidth * 0.75; // 4:3 ratio

            if (height > maxHeight) {
                height = maxHeight;
                width = maxHeight * 4 / 3;
            }

            canvas.width = width;
            canvas.height = height;

            // Re-initialize paddle/ball dimensions on resize
            initGameObjects();

            if (gameActive || messageBox.style.display !== 'none') {
                drawGame();
            }
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas(); // Initial setup


        function initGameObjects() {
            const paddleW = canvas.width * PADDLE_WIDTH_RATIO;
            const paddleH = canvas.height * PADDLE_HEIGHT_RATIO;
            const ballS = canvas.width * BALL_SIZE_RATIO;

            // Player 1 (Left)
            p1 = {
                x: paddleW * 2,
                y: canvas.height / 2 - paddleH / 2,
                width: paddleW,
                height: paddleH,
                vy: 0, // velocity y
                score: p1Score
            };

            // Player 2 (Right)
            p2 = {
                x: canvas.width - paddleW * 3,
                y: canvas.height / 2 - paddleH / 2,
                width: paddleW,
                height: paddleH,
                vy: 0,
                score: p2Score
            };

            // Ball
            ball = {
                x: canvas.width / 2,
                y: canvas.height / 2,
                size: ballS,
                vx: 0, // velocity x
                vy: 0, // velocity y
                speed: INITIAL_BALL_SPEED // Starts slow using the new constant
            };
        }

        function serveBall(direction) {
            ball.x = canvas.width / 2;
            ball.y = canvas.height / 2;
            
            // Random initial vertical angle
            let angle = Math.random() * Math.PI/2 - Math.PI/4; // between -45 and 45 degrees
            
            // Apply direction (left or right)
            if (direction === 'LEFT') {
                ball.vx = -ball.speed * Math.cos(angle);
            } else {
                ball.vx = ball.speed * Math.cos(angle);
            }
            ball.vy = ball.speed * Math.sin(angle);
        }


        // --- Game Loop and Update ---

        function gameLoop(currentTime) {
            if (!gameActive) return;

            const deltaTime = (currentTime - lastTime) / 1000; // Time difference in seconds
            lastTime = currentTime;

            updateGame(deltaTime);
            drawGame();

            requestAnimationFrame(gameLoop);
        }

        function updateGame(dt) {
            updatePaddles(dt);
            updateBall(dt);
        }

        function updatePaddles(dt) {
            // Player 1 (W/S)
            p1.vy = 0;
            if (keys['w']) p1.vy = -PADDLE_SPEED;
            if (keys['s']) p1.vy = PADDLE_SPEED;

            p1.y += p1.vy * dt * 60; // 60 is for scaling paddle speed relative to fixed FPS
            p1.y = Math.max(0, Math.min(canvas.height - p1.height, p1.y)); // Clamp P1

            // Player 2 (Up/Down)
            p2.vy = 0;
            if (keys['ArrowUp']) p2.vy = -PADDLE_SPEED;
            if (keys['ArrowDown']) p2.vy = PADDLE_SPEED;

            p2.y += p2.vy * dt * 60; // 60 is for scaling paddle speed relative to fixed FPS
            p2.y = Math.max(0, Math.min(canvas.height - p2.height, p2.y)); // Clamp P2
        }

        function updateBall(dt) {
            ball.x += ball.vx * dt * 60;
            ball.y += ball.vy * dt * 60;

            // 1. Top/Bottom Wall Collision
            if (ball.y < ball.size / 2 || ball.y > canvas.height - ball.size / 2) {
                ball.vy *= -1; // Reverse vertical direction
                
                // Keep ball within bounds
                if (ball.y < ball.size / 2) ball.y = ball.size / 2;
                if (ball.y > canvas.height - ball.size / 2) ball.y = canvas.height - ball.size / 2;
            }

            // 2. Goal Check (Left/Right walls)
            if (ball.x < 0) {
                // Player 2 scores
                p2Score++;
                player2ScoreDisplay.textContent = p2Score;
                resetAfterGoal(p2Score, 'RIGHT'); // Serve to the right
            } else if (ball.x > canvas.width) {
                // Player 1 scores
                p1Score++;
                player1ScoreDisplay.textContent = p1Score;
                resetAfterGoal(p1Score, 'LEFT'); // Serve to the left
            }

            // 3. Paddle Collision
            
            // Check for collision with Player 1 (Left)
            if (ball.x - ball.size / 2 < p1.x + p1.width &&
                ball.y > p1.y && ball.y < p1.y + p1.height &&
                ball.vx < 0) { // Only check if moving left
                
                handlePaddleHit(p1);
            }

            // Check for collision with Player 2 (Right)
            if (ball.x + ball.size / 2 > p2.x &&
                ball.y > p2.y && ball.y < p2.y + p2.height &&
                ball.vx > 0) { // Only check if moving right
                
                handlePaddleHit(p2);
            }
        }

        function handlePaddleHit(paddle) {
            // 1. Reverse X direction
            ball.vx *= -1;

            // 2. Adjust ball position to prevent sticking
            if (paddle === p1) {
                ball.x = p1.x + p1.width + ball.size / 2;
            } else {
                ball.x = p2.x - ball.size / 2;
            }
            
            // 3. Calculate deflection angle based on where the ball hit the paddle
            const relativeIntersectY = (paddle.y + (paddle.height / 2)) - ball.y;
            const normalizedRelativeIntersectionY = relativeIntersectY / (paddle.height / 2);
            const bounceAngle = normalizedRelativeIntersectionY * (Math.PI / 3); // Max 60 degrees

            // 4. Increase speed slightly and apply new velocity components
            ball.speed = Math.min(ball.speed * 1.05, MAX_BALL_VELOCITY);
            
            // The sign of ball.vx determines the horizontal direction (already flipped above)
            ball.vx = Math.abs(ball.vx) * Math.cos(bounceAngle) * Math.sign(ball.vx);
            ball.vy = ball.speed * -Math.sin(bounceAngle); 
        }
        
        function resetAfterGoal(score, nextServeDirection) {
            if (score >= WINNING_SCORE) {
                gameOver();
            } else {
                gameActive = false; // Pause game for a moment
                // Prepare ball for next serve
                ball.vx = 0;
                ball.vy = 0;
                ball.x = canvas.width / 2;
                ball.y = canvas.height / 2;
                ball.speed = INITIAL_BALL_SPEED; // Reset to the slower initial speed
                
                // Show message box with a serve prompt
                messageTitle.textContent = 'SERVE';
                messageText.textContent = `Player ${nextServeDirection === 'LEFT' ? '1' : '2'} scored! Press START to serve.`;
                startButton.textContent = 'SERVE ' + nextServeDirection;
                startButton.onclick = () => {
                    messageBox.style.display = 'none';
                    gameActive = true;
                    serveBall(nextServeDirection);
                    lastTime = performance.now(); // Reset timer for smooth start
                    requestAnimationFrame(gameLoop);
                };
                messageBox.style.display = 'flex';
            }
        }

        function gameOver() {
            gameActive = false;
            let winner = p1Score > p2Score ? 1 : 2;

            messageTitle.textContent = `PLAYER ${winner} WINS!`;
            messageText.textContent = `Final Score: ${p1Score} - ${p2Score}. Great game!`;
            startButton.textContent = 'PLAY AGAIN';
            startButton.onclick = startGame;
            messageBox.style.display = 'flex';
        }

        // --- Drawing Functions ---

        function drawGame() {
            // 1. Clear Canvas
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#fff';

            // 2. Draw Center Line (dashed)
            ctx.beginPath();
            ctx.setLineDash([5, 10]); // Dash length 5, gap 10
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.lineWidth = 2;
            ctx.strokeStyle = '#fff';
            ctx.stroke();
            ctx.setLineDash([]); // Reset line dash

            // 3. Draw Paddles
            ctx.fillRect(p1.x, p1.y, p1.width, p1.height);
            ctx.fillRect(p2.x, p2.y, p2.width, p2.height);

            // 4. Draw Ball (centered rectangle for that true retro feel)
            ctx.fillRect(
                ball.x - ball.size / 2,
                ball.y - ball.size / 2,
                ball.size,
                ball.size
            );
        }

        // --- Input Handling ---
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            // Check if game is waiting for start/serve
            if (!gameActive && messageBox.style.display !== 'none' && (e.key === ' ' || e.key === 'Enter')) {
                e.preventDefault();
                startButton.click(); // Trigger the start/serve button
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Mobile controls (optional but good practice)
        // Since this is a 2-player keyboard game, touch controls are complex. 
        // We'll rely on the desktop experience for this classic.

        // --- Game Flow Initialization ---

        function startGame() {
            p1Score = 0;
            p2Score = 0;
            player1ScoreDisplay.textContent = p1Score;
            player2ScoreDisplay.textContent = p2Score;
            
            initGameObjects(); // Reset positions/sizes
            
            // Initial serve to the right
            resetAfterGoal(0, 'RIGHT'); 
        }

        startButton.addEventListener('click', startGame);
        
        // Draw the initial state and show the welcome message
        drawGame(); 

    </script>
</body>
</html>